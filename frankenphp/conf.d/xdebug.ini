; =============================================================================
; XDEBUG 3.x CONFIGURATION - frankenphp/conf.d/xdebug.ini
; For PHP 8.5 ZTS + FrankenPHP development and staging environments
; =============================================================================

[xdebug]
zend_extension = xdebug

; =============================================================================
; MODE CONFIGURATION
; =============================================================================
; Modes: off, develop, coverage, debug, gcstats, profile, trace
; Set via XDEBUG_MODE environment variable for runtime flexibility
; Development default: debug,develop (step debugging + improved var_dump)
xdebug.mode = ${XDEBUG_MODE}

; =============================================================================
; DEBUGGING ACTIVATION
; =============================================================================
; trigger = Only activate when XDEBUG_TRIGGER cookie/header/query param present
; Minimizes overhead when not actively debugging
xdebug.start_with_request = trigger

; Accept any trigger value (or set specific: "mykey,anotherkey")
xdebug.trigger_value = ""

; IDE session identifier for PHPStorm
xdebug.idekey = PHPSTORM

; =============================================================================
; CLIENT CONNECTION (Docker to Host IDE)
; =============================================================================
; host.docker.internal works on Mac/Windows Docker Desktop
; Linux: add extra_hosts: ["host.docker.internal:host-gateway"] to docker-compose
xdebug.client_host = host.docker.internal

; Xdebug 3 default port (was 9000 in Xdebug 2)
xdebug.client_port = 9003

; Auto-discover client from request headers (useful for multi-developer setups)
xdebug.discover_client_host = true

; Connection timeout - fail fast if IDE not listening
xdebug.connect_timeout_ms = 200

; =============================================================================
; OUTPUT DIRECTORIES
; =============================================================================
; Base directory for profiler and trace output
; Ensure writable: mkdir -p /var/xdebug/output && chown www-data:www-data
xdebug.output_dir = /var/xdebug/output

; =============================================================================
; PROFILING CONFIGURATION
; =============================================================================
; Filename format: cachegrind.out.{timestamp}.{pid}.{uri}
xdebug.profiler_output_name = cachegrind.out.%t.%p.%R

; Don't append to existing files
xdebug.profiler_append = 0

; =============================================================================
; FUNCTION TRACE CONFIGURATION
; =============================================================================
xdebug.trace_output_name = trace.%t.%p.%R

; 0 = human readable, 1 = computerized (tab-separated), 2 = HTML
xdebug.trace_format = 0

; Include return values in traces
xdebug.collect_return = true

; =============================================================================
; DEVELOPMENT HELPERS
; =============================================================================
; Colored CLI output for var_dump
xdebug.cli_color = 1

; Show local variables in stack traces
xdebug.show_local_vars = 1

; Dump superglobals on errors
xdebug.dump.SERVER = REQUEST_URI,REQUEST_METHOD,HTTP_HOST
xdebug.dump.GET = *
xdebug.dump.POST = *
xdebug.dump_once = 1

; Prevent infinite recursion
xdebug.max_nesting_level = 512
xdebug.max_stack_frames = 100

; =============================================================================
; LOGGING
; =============================================================================
; Log connection attempts for troubleshooting
xdebug.log = /var/log/xdebug/xdebug.log
xdebug.log_level = 7

; =============================================================================
; IDE INTEGRATION
; =============================================================================
; Clickable stack trace links in PHPStorm
xdebug.file_link_format = 'phpstorm://open?file=%f&line=%l'