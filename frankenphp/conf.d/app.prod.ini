; =============================================================================
; PRODUCTION PHP CONFIGURATION - frankenphp/conf.d/app.prod.ini
; Optimized for FrankenPHP worker mode with maximum performance and security
; =============================================================================

[PHP]
; === Memory ===
memory_limit = 256M

; === PHP 8.5: Hard ceiling prevents runaway memory allocation ===
max_memory_limit = 512M

; === Execution Limits - Reasonable for API workloads ===
max_execution_time = 60
max_input_time = 60

; === File Uploads - Matched to VichUploaderBundle requirements ===
upload_max_filesize = 64M
post_max_size = 72M
max_file_uploads = 20

; === Error Handling - Errors to Sentry, never displayed ===
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT
display_errors = Off
display_startup_errors = Off

; === Stack Traces - Hide sensitive data in production ===
zend.exception_ignore_args = On
; PHP 8.5: Still enable backtraces but without sensitive args
fatal_error_backtraces = On

; === Security Hardening ===
expose_php = Off
allow_url_fopen = Off
allow_url_include = Off

; === Disable dangerous functions ===
; Note: Some may be needed by your app - audit before deployment
disable_functions = exec,passthru,shell_exec,system,proc_open,popen,show_source

; === Realpath Cache - Long TTL for immutable deployments ===
realpath_cache_size = 4096K
realpath_cache_ttl = 600

; === OPcache Production Settings ===
[opcache]
; CRITICAL: Disable timestamp validation in production
; FrankenPHP worker mode keeps PHP resident - files don't change
; Requires container restart on deployment (which you're doing anyway)
opcache.validate_timestamps = 0

; Memory and limits
opcache.memory_consumption = 256
opcache.interned_strings_buffer = 16
opcache.max_accelerated_files = 32531

; Preloading - Symfony generates this file automatically
; Note: Benefits are reduced in worker mode since app stays bootstrapped
; but still provides modest improvements for cold starts
opcache.preload = /app/config/preload.php
opcache.preload_user = www-data

; Enable file override for reduced filesystem I/O
opcache.enable_file_override = 1

; Save comments for Doctrine/API Platform annotations
opcache.save_comments = 1